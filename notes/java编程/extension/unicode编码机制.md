
# Unicode编码机制

> 参考资料：
>
> - [Unicode_and_Character_Sets](https://github.com/acmerfight/insight_python/blob/master/Unicode_and_Character_Sets.md)
> - [字符编码笔记：ASCII，Unicode 和 UTF-8](http://www.ruanyifeng.com/blog/2007/10/ascii_unicode_and_utf-8.html)
> - Java 核心技术 卷1



**ASCII码**

ASCII 一共定义了 128 个字符，使用了一个字节的后 7 位，最前面的一位统一规定为0。定义的这些字符包括英文字母 A-Z，a-z，数字 0-9，一些标点符号和控制符号。

**非ASCII编码**

ASCII 码只使用了一个字节中的 7 位，但即便将一个字节剩余的一位也利用上仍远远不能表示所有字符（仅汉字就有 10 多万）。

使用多个字节表示一个字符可以满足需求。但是具体使用几个字节来表示无法达成统一：如果过多，比如 3~4 个，会造成存储的极大浪费；如果过少，比如 2 个，又无法满足部分需要三或四个字节的.

很自然地可以想到，需要几个字节来表示一个字符时就用几个字节，但如何实现这一点是一个问题。这里以 Unicode 和 utf-8 为例进行说明。

## Unicode 和 utf-8

在介绍 Unicode 和 utf-8 之前，需要厘清几个概念：

- 字符表（Character repertoire）：一个系统所支持的字符的**集合**。

- 字符集（CCS:Coded Character Set）：字符表到一个整数集合的**映射**，又称编码字符集，或者叫**码点**。Unicode 就是属于这一层的概念， 即 Unicode 是字符集合到整数集合的一个映射，是一个纯数学的抽象。

  > 码点：是指与一个编码表中的某个字符对应的代码值。Unicode标准中，码点采用16进制书写，并加上前缀U+，如字母A的码点为U+0041。Unicode的码点可以分为17个代码级别。

- 字符编码表（CEF:Character Encoding Form）：将 CCS 里字符对应的整数转换成有限长度的比特值，便于以后计算机使用一定长度的二进制形式表示该整数，这个对应关系被称为字符编码表。UTF-8， UTF-16 都属于这层。也即，UTF-8，UTF-16，UTF-32都是 Unicode 的**实现方式**。

- 字符编码方案（CES:Character Encoding Scheme）： CEF 得到的比特值在计算机中进行存储、传输的解决方案（如大、小端问题）。
  

**Unicode**

Unicode 可以容纳100多万个符号。每个符号的编码都不一样，比如，U+0639表示阿拉伯字母 'Ain'，U+0041 表示英语的大写字母 'A'，U+4E25 表示汉字'严'。

> 注意：这里的编码只是字符对应的 Unicode 的编码，而不是实际在计算机中存储的编码。

表示字符所对应的 Unicode 的编码需要的字节数不固定，可能只需要一个（ASCII 码），可能需要 3 或 4 个。而计算机该如何识别三个字节是表示的三个字符还是表示的一个字符？而这就涉及到了 Unicode 的多种实现方式。

**utf-8 ：Unicode 的实现方式之一**

utf-8 是一种变长的编码方式。它可以使用 **1~4** 个字节表示一个符号，根据不同的符号而变化字节长度。因此 utf-8 的**代码单元**为 8 比特。

> 代码单元（Code Unit）：是指一个已编码的文本中具有最短的比特组合的单元。对于UTF-8来说，代码单元是 8 比特长；对于 UTF-16 来说，代码单元是 16 比特长。换一种说法就是 UTF-8 的是以一个字节为最小单位的，UTF-16 是以两个字节为最小单位的。

utf-8 的编码规则很简单，只有两条：

- 对于单字节的符号，字节的第一位设为0，后面7位为这个符号的 Unicode 码。因此对于英语字母，UTF-8 编码和 ASCII 码是相同的。

- 对于n字节的符号（n > 1），第一个字节的前n位都设为1，第n + 1位设为0，后面字节的前两位一律设为10。剩下的没有提及的二进制位，全部为这个符号的 Unicode 码。

| unicode 符号范围（16进制） | UTF-8 编码方式（二进制）            |
| -------------------------- | ----------------------------------- |
| 0000    0000-0000    007F  | 0xxxxxxx                            |
| 0000    0080-0000    07FF  | 110xxxxx 10xxxxxx                   |
| 0000    0800-0000    FFFF  | 1110xxxx 10xxxxxx 10xxxxxx          |
| 0001    0000-0010    FFFF  | 11110xxx 10xxxxxx 10xxxxxx 10xxxxxx |

跟据上表，解读 UTF-8 编码非常简单。如果一个字节的第一位是0，则这个字节单独就是一个字符；如果第一位是1，则连续有多少个1，就表示当前字符占用多少个字节。详情可参看 [字符编码笔记：ASCII，Unicode 和 UTF-8](http://www.ruanyifeng.com/blog/2007/10/ascii_unicode_and_utf-8.html)。

